<div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm mb-4 overflow-hidden">

  <!-- Row 1: Search + View Toggle -->
  <div class="flex items-center gap-3 px-4 py-3">

    <!-- Search input with icon -->
    <div class="relative flex-1">
      <ng-icon
        name="lucideSearch"
        size="15"
        class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none"
      />
      <input
        type="search"
        placeholder="Search tasksâ€¦"
        [value]="taskStore.filters().search"
        (input)="onSearch($event)"
        aria-label="Search tasks"
        class="peer w-full pl-9 pr-12 py-2 text-sm bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 dark:focus:border-blue-400 transition-colors"
      />
      <kbd class="pointer-events-none absolute right-2.5 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-5 h-5 text-[10px] font-mono font-bold bg-gray-100 dark:bg-gray-600/80 border border-gray-300 dark:border-gray-500 rounded text-gray-400 dark:text-gray-400 shadow-sm leading-none transition-opacity peer-focus:opacity-0">
        /
      </kbd>
    </div>

    <!-- View toggle (desktop only) -->
    @if (!isMobile()) {
      <div class="flex items-center bg-gray-100 dark:bg-gray-700/60 border border-gray-200 dark:border-gray-600 rounded-lg p-0.5 gap-0.5 shrink-0">
        <button
          (click)="uiStore.setTaskView('list')"
          [class]="'flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-md transition-all ' +
            (uiStore.taskView() === 'list'
              ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm'
              : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200')"
          aria-label="List view"
        >
          <ng-icon name="lucideList" size="14" />
          List
        </button>
        <button
          (click)="uiStore.setTaskView('kanban')"
          [class]="'flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-md transition-all ' +
            (uiStore.taskView() === 'kanban'
              ? 'bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm'
              : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200')"
          aria-label="Kanban view"
        >
          <ng-icon name="lucideLayoutDashboard" size="14" />
          Kanban
        </button>
      </div>
    }
  </div>

  <!-- Divider -->
  <div class="border-t border-gray-100 dark:border-gray-700/60"></div>

  <!-- Row 2: Filters -->
  <div class="flex flex-wrap items-center gap-2 px-4 py-2.5">
    <span class="flex items-center gap-1.5 text-xs font-semibold text-gray-400 dark:text-gray-500 select-none mr-1">
      <ng-icon name="lucideSlidersHorizontal" size="13" />
      Filters
    </span>

    <select
      [value]="taskStore.filters().status ?? ''"
      (change)="onStatusChange($event)"
      aria-label="Filter by status"
      class="px-2.5 py-1.5 text-xs border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 dark:focus:border-blue-400 transition-colors cursor-pointer dark:[color-scheme:dark]"
    >
      <option value="">All Statuses</option>
      @for (s of statuses; track s) {
        <option [value]="s">{{ s }}</option>
      }
    </select>

    <select
      [value]="taskStore.filters().category ?? ''"
      (change)="onCategoryChange($event)"
      aria-label="Filter by category"
      class="px-2.5 py-1.5 text-xs border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 dark:focus:border-blue-400 transition-colors cursor-pointer dark:[color-scheme:dark]"
    >
      <option value="">All Categories</option>
      @for (c of categories; track c) {
        <option [value]="c">{{ c }}</option>
      }
    </select>

    <select
      [value]="taskStore.filters().priority ?? ''"
      (change)="onPriorityChange($event)"
      aria-label="Filter by priority"
      class="px-2.5 py-1.5 text-xs border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 dark:focus:border-blue-400 transition-colors cursor-pointer dark:[color-scheme:dark]"
    >
      <option value="">All Priorities</option>
      @for (p of priorities; track p) {
        <option [value]="p">{{ p }}</option>
      }
    </select>

    @if (taskStore.hasActiveFilters()) {
      <button
        (click)="taskStore.resetFilters()"
        class="ml-1 flex items-center gap-1.5 px-2.5 py-1.5 text-xs font-medium text-red-500 dark:text-red-400 hover:text-red-600 dark:hover:text-red-300 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 border border-red-200 dark:border-red-800/50 rounded-lg transition-colors"
      >
        <ng-icon name="lucideX" size="12" />
        Clear all
      </button>
    }
  </div>
</div>
